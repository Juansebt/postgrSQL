--1.- SELECCIONAR LOS PACIENTE CUYOS NOMBRES TERMINEN CON UNA A O QUE SUS APELLIDOS TERMINEN CON UNA Z
--ORDENARLOS POR SU ID DE FORMA DESCENDENTE.

SELECT * FROM CLINICA.PACIENTE
WHERE nombre LIKE '%A' OR apellido LIKE '%Z'
ORDER BY pk_idPaciente;

--2.- CONTAR LOS ESPECIALISTAS Y AGRUPARLOS POR SU ESPECIALIDAD
--RENOMBRAR COLUMNA EN CASO QUE SEA NECESARIO

SELECT COUNT(pk_idEspecialista) AS cantidad_especialistas, especialidad FROM CLINICA.ESPECIALISTA
GROUP BY especialidad;

--3.- SELECCIONAR LOS EXPEDIENTES DIAGNOSTICOS CUYO peso sea mayor a 50 o la edad mayor a 30

SELECT fk_idPaciente, edad, peso, altura FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
WHERE (peso < '50' OR edad > '30')

--4.- SELECCIONAR LAS LLAVES FORANEAS DE PACIENTE Y ESPECIALISTA UTILIZANDO LA INSTRUCCION DISTINCT DE LA TABLA DE EXPEDIENTE DIAGNOSTICO

SELECT DISTINCT (fk_idPaciente, fk_idEspecialista)  
FROM CLINICA.EXPEDIENTE_DIAGNOSTICO;

--5.- SELECCIONAR LAS COLUMNAS DE FOLIO, ID DE PACIENTE, ID DE ESPECIALISTA Y FECHA DE CREACION 
--LOS DIAGNOSTICOS DE LOS PACIENTE QUE TENGAN UNA EDAD MAYOR A 25 Y SU NIVEL DE PESO NO SEA NORMAL,
--ADEMÁS QUE SU FECHA DE DIAGNOSTICO SEA MAYOR A FEBREO DEL 2021, ORDENARLOS POR EL ID DE ESPECIALISTA. 

SELECT folio, fk_idPaciente, fk_idEspecialista, fechaCreacion FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
WHERE nivelPeso NOT IN ('NORMAL') AND edad > '25' AND fechaCreacion > '2021-02-01'
GROUP BY folio
ORDER BY fk_idEspecialista;

--6.- SELECCIONAR LOS ESPECIALISTAS QUE HAYAN HECHO DIAGNOSTICOS CUYO NIVEL DE PESO SEA SOBREPESO.

SELECT * FROM CLINICA.ESPECIALISTA
WHERE pk_idEspecialista IN (SELECT fk_idEspecialista
							FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
							WHERE nivelPeso IN ('SOBREPESO'));


--7.- SELECCIONAR CUÁNTOS DIAGNOSTICOS TIENEN CADA PACIENTE INGRESADO Y AGRUPARLOS POR SU ID, ORDENARLO LA CANTIDAD DE CITAS DE MAYOR A MENOR

SELECT fk_idPaciente, COUNT(fk_idPaciente) AS cantidad_citas
FROM CLINICA.EXPEDIENTE_DIAGNOSTICO 
GROUP BY fk_idPaciente ORDER BY COUNT(fk_idPaciente) DESC;


--8.- SELECCIONA LOS EXPEDIENTES DE LOS PACIENTES QUE TENGAN NIVELES DE PESO EN NORMAL Y SOBREPESO, 
ADEMÁS QUE LOS HAYAN ATENDIDO LOS ESPECIALISTA CUYA ESPECIALIDAD NO SEA DE MEDICO GENERAL

SELECT * FROM CLINICA.EXPEDIENTE_DIAGNOSTICO 
WHERE nivelPeso IN('NORMAL','SOBREPESO') 
AND fk_idEspecialista IN (SELECT pk_idEspecialista FROM CLINICA.ESPECIALISTA
						 WHERE especialidad NOT IN ('MEDICO GENERAL'))


--9.- SELECCIONAR LOS PACIENTES QUE VIVAN EN LA CIUDAD DE MEXICO Y QUE HALLAN NACIDE DEPUES DE 1990, 
--ADEMÁS QUE NO TENGAN ALERGÍAS O PADECIMIENTOS CRONICOS
--POR ÚLTIMO QUE HALLAN RECIBIDO DIAGNOSTICOS DE LOS ESPECIALISTAS CUYOS ID SEAN: ME-0001, ME-0002 Y ME-0003 

SELECT * FROM CLINICA.PACIENTE 
WHERE ciudad = 'MEXICO' AND fechaNacimiento <= '1990-01-01' 
AND pk_idPaciente IN (SELECT pk_idPaciente FROM CLINICA.EXPEDIENTE
					  WHERE tipoAlergia = 'NA' OR padecimientoCro = 'NA')
AND pk_idPaciente IN (SELECT fk_idPaciente FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
					  WHERE fk_idEspecialista IN('ME-0001', 'ME-0002', 'ME-0003'));	


--10.- SELECCIONAR MEDIANTE UN INNER JOIN ANIDADO LAS TABLAS DE PACIENTE, CITA, AGENDAR_CITA Y ESPECIALISTA
--ADEMÁS REALIZAR DENTRO DEL JOIN UNA SUBCONSULTA PARA SABER LOS DIAGNOSTICOS DE LOS PACIENTES
--QUE TENGAN UN PESO MAYOR A 70 O UNA EDAD MAYOR A 20

SELECT * FROM CLINICA.PACIENTE
INNER JOIN CLINICA.CITA
ON PACIENTE.pk_idPaciente = CITA.fk_idPaciente
INNER JOIN CLINICA.AGENDAR_CITA
ON CITA.pk_idCita = AGENDAR_CITA.fk_idCita
INNER JOIN CLINICA.ESPECIALISTA
ON AGENDAR_CITA.fk_idEspecialista = ESPECIALISTA.pk_idEspecialista
WHERE PACIENTE.pk_idPaciente IN (SELECT pk_idPaciente 
								 FROM CLINICA.EXPEDIENTE_DIAGNOSTICO
								 WHERE peso >  '70' OR edad > '20');


--11.- SELECCIONAR LOS DIAGNOSTICOS, ADEMÁS EXTRAER LOS PACIENTES QUE SEAN DE SEXO MASCULINO,
--POR ÚLTIMO EXTRAER LAS COLUMNAS DE NOMBRE, APELLIDO Y ESPECIALIDAD DE LA TABLA DE ESPECIALISTA

SELECT *,(SELECT nombre FROM CLINICA.ESPECIAlISTA WHERE pk_idEspecialista = EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista),
(SELECT apellido FROM CLINICA.ESPECIAlISTA WHERE pk_idEspecialista = EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista),
(SELECT especialidad FROM CLINICA.ESPECIAlISTA WHERE pk_idEspecialista = EXPEDIENTE_DIAGNOSTICO.fk_idEspecialista)
FROM CLINICA.EXPEDIENTE_DIAGNOSTICO 
WHERE fk_idPaciente IN (SELECT pk_idPaciente FROM CLINICA.PACIENTE
					   WHERE sexo = 'M')

--12.-MEDIANTE UN INNER JOIN SELECCIONAR LAS TABLAS DE PACIENTE CITA Y AGENDAR CITA, EN DONDE LA FECHA DE CITA ESTE ENTRE DOS FECHAS
ADEMÁS QUE LAS CIUDADES DE LOS PACIENTES SEAN MEXICO O MONTERREY, POR ULTIMO QUE EL TIPO DE SANGRE DE LOS PACIENTES SEA O POSITIVO

SELECT * FROM CLINICA.PACIENTE
INNER JOIN CLINICA.CITA
ON PACIENTE.pk_idPaciente = CITA.fk_idPaciente
INNER JOIN CLINICA.AGENDAR_CITA
ON CITA.pk_idCita = AGENDAR_CITA.fk_idCita
WHERE AGENDAR_CITA.fechaCita BETWEEN '2022-10-04' AND '2022-10-08'
AND PACIENTE.ciudad IN('MEXICO', 'MOTERREY')
AND PACIENTE.pk_idPaciente IN (SELECT pk_idPaciente FROM CLINICA.EXPEDIENTE
							  WHERE tipoSangre ='O POSITIVO')
								 
								 



			 